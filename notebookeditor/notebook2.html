<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Insert Span</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"
      onload="renderMathInElement(document.body);"></script>
  <link href="style.css" rel="stylesheet" type="text/css" />
  <link rel='stylesheet'
    href='https://cdn-uicons.flaticon.com/2.4.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.0/uicons-thin-rounded/css/uicons-thin-rounded.css'>
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.4.0/uicons-bold-rounded/css/uicons-bold-rounded.css'>

  
  <link href="toolbox_style.css" rel="stylesheet" type="text/css" />

</head>

<body>
  <div id="editModal" class="modal">
    <div class="modal-content">
      <textarea id="editText" rows="4" cols="50"></textarea>
      <button id="saveButton" onclick="saveEditedText()">Save</button>
    </div>
  </div>

  <div id="editModal_newline" class="modal">
    <div class="modal-content_newline">
      <textarea id="editText_newline" rows="4" cols="50"></textarea>
      <button id="saveButton_newline" onclick="saveEditedText_newline()">Save</button>
    </div>
  </div>



  <div class="toolbar">
    <div class="tab-indicator"></div> <!-- Sliding Indicator -->
    <button class="tab-button active" onclick="switchTab(event, 'main')">Main</button>
    <button class="tab-button" onclick="switchTab(event, 'font')">Font</button>
    <button class="tab-button" onclick="switchTab(event, 'paragraph')">Paragraph</button>
    <button class="tab-button" onclick="switchTab(event, 'table')">Table</button>
  </div>

  <div id="main" class="tab-content active">
    <div style="display: flex; flex-wrap: wrap; justify-content: center; align-items: center;">
      <div class="tooltip">
        <button id="add-mathlatex" class="icon-button" aria-label="Add Inline Equation">xÂ²</button>
        <span class="tooltiptext">Add Inline Equation</span>
      </div>
      <div class="tooltip">
        <button id="add-newline-mathlatex" class="icon-button" aria-label="Add Newline Equation">//..xÂ²..//</button>
        <span class="tooltiptext">Add Newline Equation</span>
      </div>
      <div class="tooltip">
        <button class="icon-button" aria-label="Save As" onclick="saveToHTMLFile()">ðŸ’¾</button>
        <span class="tooltiptext">Save As</span>
      </div>
      <div class="tooltip">
        <button id="add-newPage" class="icon-button" aria-label="New Page">ðŸ“„</button>
        <span class="tooltiptext">Add Page</span>
      </div>
      <div class="tooltip">
        <button id="LoadNote" class="icon-button" aria-label="Export">ðŸ“¤</button>
        <span class="tooltiptext">Import</span>
      </div>
      <div class="tooltip">
        <button id="GrammarCheck" class="icon-button" onclick="toggleSpellCheckForPagebook()" aria-label="Grammar">ðŸ”Ž</button>
        <span class="tooltiptext">Toggle Grammar Check</span>
      </div>

    </div>
  </div>

  <div id="font" class="tab-content">
    <div class="font-settings">
      <label for="font-size">Font:</label>
      <input type="number" id="fontSizeInput" name="font-size" value="11" min="8" max="72" step="1"> px
      <select id="fontFamilySelect" name="font-family">
        <option value="Arial">Arial</option>
        <option value="Segoe UI">Segoe UI</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Georgia">Georgia</option>
        <option value="Courier New">Courier New</option>
      </select>
      <button onclick="applyTextStyling()">Apply Selected</button>
      <button onclick="applyStylesToContainer()">Apply All Pages</button>
    </div>
  </div>


  <div id="paragraph" class="tab-content">
    <div style="display: flex; flex-wrap: wrap; justify-content: center; align-items: center;">
      <!-- Bullet Points, using custom icon -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Bullets">
          <img src="https://github.com/QOQORO-IT/cdn/blob/main/bullet-list-icon-in-monochrome-style--ui--no-pen.png?raw=true" alt="Bullet Icon" style="width: 24px; height: 24px;">
        </button>
        <span class="tooltiptext">Bullets</span>
      </div>
      <!-- Numbering, using custom icon -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Numbering">
          <img src="https://github.com/QOQORO-IT/cdn/blob/main/numbering-list-icon-in-monochrome-style--ui.png?raw=true" alt="Numbering Icon" style="width: 24px; height: 24px;">
        </button>
        <span class="tooltiptext">Numbering</span>
      </div>
      <!-- Align Left -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Align Left"><i class="fi fi-rr-align-left"></i></button>
        <span class="tooltiptext">Align Left</span>
      </div>
      <!-- Align Center -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Align Center"><i class="fi fi-rr-align-center"></i></button>
        <span class="tooltiptext">Align Center</span>
      </div>
      <!-- Align Right -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Align Right"><i class="fi fi-rr-symbol"></i></button>
        <span class="tooltiptext">Align Right</span>
      </div>
      <!-- Justify -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Justify"><i class="fi fi-rr-align-justify"></i></button>
        <span class="tooltiptext">Justify</span>
      </div>
    </div>
  </div>


  <div id="table" class="tab-content">
    <div style="display: flex; flex-wrap: wrap; justify-content: center; align-items: center;">
      <!-- Add New Table -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Add New Table" onclick="addTableAtCaret()"><i class="fi fi-rr-table"></i></button>
        <span class="tooltiptext">Add New Table</span>
      </div>
      <!-- Add New Row -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Insert Row" onclick="addRow()"><img src="https://raw.githubusercontent.com/QOQORO-IT/cdn/main/insert_row.png?raw=true" alt="Bullet Icon" style="width: 24px; height: 24px;">
        <span class="tooltiptext">Add New Row</span>
      </div>
      <!-- Add New Column -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Insert Column" onclick="addColumn()"><img src="https://github.com/QOQORO-IT/cdn/blob/main/insert_column.png?raw=true" alt="Bullet Icon" style="width: 24px; height: 24px;"></button>
        <span class="tooltiptext">Add New Column</span>
      </div>
      <!-- Remove Row -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Remove Row" onclick="deleteRow()"><i class="fi fi-rr-delete-row"></i></button>
        <span class="tooltiptext">Remove Row</span>
      </div>
      <!-- Remove Column -->
      <div class="tooltip">
        <button class="icon-button" aria-label="Remove Column" onclick="deleteColumn()"><i class="fi fi-rr-delete-column"></i></button>
        <span class="tooltiptext">Remove Column</span>
      </div>
      <div class="tooltip">
        <button class="icon-button" aria-label="Clear Selected Cells" onclick="clearSelectedCells()"><i class="fi fi-rr-delete-column"></i></button>
        <span class="tooltiptext">Clear Selected Cells</span>
      </div>
    </div>
  </div>

  <script>
    // script.js
    function switchTab(evt, tabName) {
      let i, tabcontent, tabbuttons;

      // Hide all tab content
      tabcontent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }

      // Remove "active" class from all buttons
      tabbuttons = document.getElementsByClassName("tab-button");
      for (i = 0; i < tabbuttons.length; i++) {
        tabbuttons[i].className = tabbuttons[i].className.replace(" active", "");
      }

      // Show the current tab and activate the button
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";

      // Move the indicator
      const indicator = document.querySelector('.tab-indicator');
      const activeBtn = evt.currentTarget;
      indicator.style.width = `${activeBtn.offsetWidth}px`;
      indicator.style.left = `${activeBtn.offsetLeft}px`;
    }

    // Initial indicator setup
    window.onload = () => {
      const activeBtn = document.querySelector('.tab-button.active');
      const indicator = document.querySelector('.tab-indicator');
      if (activeBtn) {
        indicator.style.width = `${activeBtn.offsetWidth}px`;
        indicator.style.left = `${activeBtn.offsetLeft}px`;
        indicator.setAttribute("data-irremovable")
      }
      adjustTooltipPosition(); // Adjust tooltip positions on load
    }


    // Show the correct tooltip when hovering over buttons
    function adjustTooltipPosition() {
      const tooltips = document.querySelectorAll('.tooltip');

      tooltips.forEach(tooltip => {
        const button = tooltip.querySelector('.icon-button');
        const tooltipText = tooltip.querySelector('.tooltiptext');

        button.onmouseover = function (event) {
          // Get button's position relative to the viewport
          const rect = button.getBoundingClientRect();

          // Set the tooltip's position
          tooltipText.style.left = `${rect.left + window.scrollX + (button.offsetWidth / 2) - (tooltipText.offsetWidth / 2)}px`;
          tooltipText.style.top = `${rect.top + window.scrollY - tooltipText.offsetHeight - 5}px`; // 5px above the button
        };
      });
    }

    // Call this function on window load and resize to adjust tooltip positions correctly
    window.onload = adjustTooltipPosition;
    window.onresize = adjustTooltipPosition;

  </script>

  <div id="MainContainer" class="MainContainer" style="background-color: lightblue; position: relative; top: 50px;">
    <div contenteditable id="pagenumber1" class="pagebook">
      <div>Type anything inside here!</div>
    </div>
  </div>
  <input type="file" id="fileUpload" style="display: none;" accept=".qnote" onchange="loadSavedContent()" />

  <div id="script loader" class="script loader">


    <script src="script.js"></script>
    <script src="stylingtext.js"></script>
    <script src="handleOverflow.js"></script>
    <script src="handleUnderflow.js"></script>
    <script src="handleOverflowEntering.js"></script>
    <script src="handleOverflowTyping.js"></script>
    <script>
      function reOrderDivs() {
        const pagebookElements = document.querySelectorAll('.pagebook');
        pagebookElements.forEach((element, index) => {
          element.id = `pagenumber${index + 1}`;
        });
      }

      document.getElementById('add-newPage').addEventListener('click', () => {
        const newPage = document.createElement('div');
        const oldPage = document.querySelector('.pagebook');
        const pagebookElements = document.querySelectorAll('.pagebook');
        const newId = `pagenumber${pagebookElements.length + 1}`;
        let Container = document.getElementById('MainContainer');

        newPage.setAttribute('contenteditable', '');
        newPage.id = newId;
        newPage.className = 'pagebook';
        newPage.style = oldPage.style
        newPage.innerHTML = `<div>New Page ${pagebookElements.length + 1}</div>`;
        newPage.addEventListener('keyup', isCaretBeforeFirstChildDiv);
        newPage.addEventListener('click', isCaretBeforeFirstChildDiv);
        newPage.addEventListener('keyup', isCaretAfterLastChildDiv);
        newPage.addEventListener('keyup', isCaretBeforeLastChildDiv);
        newPage.addEventListener('click', isCaretAfterLastChildDiv);
        newPage.addEventListener('click', isCaretBeforeLastChildDiv);
        newPage.addEventListener('focusout', mainFocusOut, true);
        newPage.addEventListener('keydown', mainFocusOut, true);
        newPage.addEventListener('keyup', handleOverflow);

        Container.appendChild(newPage);
        reOrderDivs();
      });
    </script>
    <script src="insertMath.js"></script>
    <script src="insertMath_Newline.js"></script>
    <script src="saveNote.js"></script>
    <script src="loadNote.js"></script>
    <script src="loadNote_fromBlob.js"></script>
    <script src="paste_Clipboard.js"></script>
    <script src="tables_handler.js"></script>
    <script src="handleNestedTexts.js"></script>

    <script>
      function toggleSpellCheckForPagebook() {
          // Get all elements with class 'pagebook' that are contenteditable
          var elements = document.getElementsByClassName('pagebook');
          // Determine the current state of spellcheck based on the first element (assuming all are synced)
          var currentState = elements.length > 0 ? elements[0].spellcheck : false;
          var newState = !currentState;

          for (var i = 0; i < elements.length; i++) {
              if (elements[i].contentEditable === "true") {
                  // Set the new state for all elements at once
                  elements[i].spellcheck = newState;
              }
          }
          console.log(`Spellcheck for all editable elements is now ${newState ? 'enabled' : 'disabled'}.`);
      }

      
      document.addEventListener('DOMContentLoaded', function() {
          // Function to apply bullet points to the selected text
          document.querySelector('.icon-button[aria-label="Bullets"]').addEventListener('click', function() {
              applyList('ul');
          });

          // Function to apply numbering to the selected text
          document.querySelector('.icon-button[aria-label="Numbering"]').addEventListener('click', function() {
              applyList('ol');
          });

          // Functions to align selected text
          document.querySelector('.icon-button[aria-label="Align Left"]').addEventListener('click', function() {
              alignText('left');
          });
          document.querySelector('.icon-button[aria-label="Align Center"]').addEventListener('click', function() {
              alignText('center');
          });
          document.querySelector('.icon-button[aria-label="Align Right"]').addEventListener('click', function() {
              alignText('right');
          });
          document.querySelector('.icon-button[aria-label="Justify"]').addEventListener('click', function() {
              alignText('justify');
          });

          function applyList(type) {
              const selection = window.getSelection();
              if (selection.rangeCount > 0) {
                  const range = selection.getRangeAt(0);
                  const selectedText = range.extractContents();

                  // Create the list element (ul or ol)
                  const list = document.createElement(type);
                  const listItem = document.createElement('li');
                  listItem.appendChild(selectedText);
                  list.appendChild(listItem);

                  // Insert the new list into the original content
                  range.insertNode(list);
              }
          }

          function alignText(alignment) {
              const selection = window.getSelection();
              if (selection.rangeCount > 0) {
                  const range = selection.getRangeAt(0);
                  const selectedDiv = range.commonAncestorContainer.nodeType === 3 ? range.commonAncestorContainer.parentNode : range.commonAncestorContainer; // Checks if the container is text node, get parent
                  selectedDiv.style.textAlign = alignment;
              }
          }
      });


    </script>

    <script>
      // // Function to rewrap the image within the div
      // function wrapImages() {
      //   const pagebook = document.querySelector('.pagebook');
      //   const images = pagebook.querySelectorAll('img');

      //   images.forEach(image => {
      //     const wrapper = document.createElement('div');
      //     wrapper.classList.add('image-wrapper');
      //     image.parentNode.insertBefore(wrapper, image);
      //     wrapper.appendChild(image);
      //   });
      // }

      // // Initial wrapping of images
      // wrapImages();

      // // Set up the MutationObserver
      // const observer2 = new MutationObserver((mutationsList) => {
      //   for (const mutation of mutationsList) {
      //     if (mutation.type === 'childList') {
      //       wrapImages();
      //     }
      //   }
      // });

      // // Observe the pagebook div for changes
      // const config = { childList: true, subtree: true };
      // observer2.observe(document.getElementById('pagenumber1'), config);
    </script>
  </div>
</body>

</html>